<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Raspberry Pi with Humidity and Temperature Sensor Configuration - Hybrid Cloud IoT App</title>
        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="..">Hybrid Cloud IoT App</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="../AWS_IoT/">AWS IoT Core Configuration</a>
                            </li>
                            <li class="active">
                                <a href="./">Raspberry Pi with Humidity and Temperature Sensor Configuration</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="../AWS_IoT/">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="disabled">
                                <a rel="prev" >
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/pradeesi/HybridCloudApp/tree/master/HybridCloudApp/Documentation/edit/master/docs/RaPi_with_Sensor.md"><i class="fa fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#appendix-2-raspberry-pi-with-dht22-sensor-and-docker-container">Appendix - 2: Raspberry Pi with DHT22 Sensor and Docker Container</a></li>
            <li><a href="#1-hardware-and-software-requirements">1. Hardware and Software Requirements:</a></li>
            <li><a href="#2-dht22-sensor-connection-with-raspberry-pi">2. DHT22 Sensor Connection with Raspberry Pi</a></li>
            <li><a href="#3-burn-raspbian-os-on-the-sd-card-and-enable-ssh">3. Burn Raspbian OS on the SD Card and enable SSH</a></li>
            <li><a href="#4-ssh-into-the-raspberry-pi-and-install-docker-runtime">4. SSH into the Raspberry Pi and Install Docker Runtime</a></li>
            <li><a href="#5-download-required-files-and-upload-on-raspberry-pi">5. Download Required Files and Upload on Raspberry Pi:</a></li>
            <li><a href="#6-test-the-container-on-raspberry-pi">6. Test the Container on Raspberry Pi:</a></li>
            <li><a href="#7-configure-raspberry-pi-to-trigger-the-sensor-container-at-startup">7. Configure Raspberry Pi to Trigger the Sensor Container at Startup:</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="appendix-2-raspberry-pi-with-dht22-sensor-and-docker-container">Appendix - 2: Raspberry Pi with DHT22 Sensor and Docker Container</h1>
<h2 id="1-hardware-and-software-requirements">1. Hardware and Software Requirements:</h2>
<p>Following are the Hardware and Software prerequisites that you need before you begin with this article - </p>
<h3 id="11-hardware">1.1 Hardware:</h3>
<ul>
<li>Raspberry Pi with Power Adapter</li>
<li>SD Card and SD Card Reader</li>
<li>Ethernet Cable</li>
<li>DHT22 Sensor</li>
<li>10K Ohm Resistor</li>
<li>Jumper wires and Breadboard</li>
<li>Keyboard and Monitor (Optional)</li>
</ul>
<h3 id="12-software">1.2 Software:</h3>
<ul>
<li><a href="https://www.raspberrypi.org/downloads/raspbian/">Official Raspbian Image</a></li>
<li><a href="https://www.balena.io/etcher/">Etcher</a> for flashing Raspbian OS image into theSD card</li>
</ul>
<h2 id="2-dht22-sensor-connection-with-raspberry-pi">2. DHT22 Sensor Connection with Raspberry Pi</h2>
<p>You can connect the DHT22 sensor with Raspberry Pi as shown in the following image. Pin 1 and Pin 4 on the sensor should be connected to the 3.3V Power Pin and Ground Pin respectively. Pin 2 on the sensor should be connected to GPIO Pin 4.</p>
<p><img alt="Rapi" src="https://raw.githubusercontent.com/pradeesi/HybridCloudApp/master/HybridCloudApp/Documentation/images/Rapi_sensor_connection.png" /></p>
<h2 id="3-burn-raspbian-os-on-the-sd-card-and-enable-ssh">3. Burn Raspbian OS on the SD Card and enable SSH</h2>
<p>Download the <a href="https://www.raspberrypi.org/downloads/raspbian/">Rasbian</a> OS and use [Etcher] (https://www.balena.io/etcher/) to install it on the SD card. For headless setup, open the SD Card on your computer, after the installation process gets completed to enable SSH.</p>
<p>SSH can be enabled by placing a file named ssh, without any extension, onto the boot partition of the SD card from another computer. When the Pi boots, it looks for the ssh file. If it is found, SSH is enabled and the file is deleted. The content of the file does not matter; it could contain text, or nothing at all.</p>
<p>If you have loaded Raspbian onto a blank SD card, you will have two partitions. The first one, which is the smaller one, is the boot partition. Place the file into this one.</p>
<p>Now plug the SD card into your Raspberry Pi and power it on.</p>
<h2 id="4-ssh-into-the-raspberry-pi-and-install-docker-runtime">4. SSH into the Raspberry Pi and Install Docker Runtime</h2>
<p>SSH into your Raspberry Pi using the following command (replace <ip-address> with the IP Address assigned to your raspberry Pi) -</p>
<pre><code>ssh pi@&lt;ip address&gt;
</code></pre>
<p>On the password prompt you could use the default raspberry password - "<strong>raspberry</strong>"</p>
<p>Now you should have access to the shell. Upgrade raspbian packages using the following command - </p>
<pre><code>sudo apt-get update &amp;&amp; sudo apt-get upgrade
</code></pre>
<p>Install Docker runtime using the following command -</p>
<pre><code>curl -sSL https://get.docker.com | sh
</code></pre>
<p>Add permission to Pi user to run Docker commands by adding “pi” user to “docker” group using the following command –</p>
<pre><code>sudo usermod -aG docker pi
</code></pre>
<p>You must Log off from Raspberry Pi and Login again, for this to take effect.</p>
<p>Check Docker installation using the following command -</p>
<pre><code>docker --version
</code></pre>
<p>If you see the correct version, you are good to go.</p>
<h2 id="5-download-required-files-and-upload-on-raspberry-pi">5. Download Required Files and Upload on Raspberry Pi:</h2>
<p><strong>5.1</strong> Download the Certificate files from from AWS IoT core as described in Appendix - 1</p>
<p><strong>5.2</strong> Download the "<strong>settings.ini</strong>" from github repo - <a href="https://github.com/pradeesi/HybridCloudApp/blob/master/HybridCloudApp/RaspberryPi/settings.ini">Link</a></p>
<p><strong>5.3</strong> Update the settings file variables accordingly.</p>
<p><strong>5.4</strong> Login to Raspberry Pi and create new settings folder under the 'pi' user's home directory, using the following command - </p>
<pre><code>mkdir /home/pi/settings
</code></pre>
<p><strong>5.5</strong> Upload the AWS Certificate Files and updated "settings.ini" file on Raspberry Pi using sftp -</p>
<pre><code>sftp pi@&lt;ip-address&gt;

cd /home/pi/settings

put &lt;file-name&gt;
</code></pre>
<p><strong>Note:</strong> Make sure you copy the updated settings.ini, Amazon RootCA Certificate file, AWS IoT Core Things Certificate &amp; Private Key files into the '/home/pi/settings' directory on your Raspberry Pi.</p>
<p><strong>5.6</strong> Close the sftp session using the following command -</p>
<pre><code>bye
</code></pre>
<h2 id="6-test-the-container-on-raspberry-pi">6. Test the Container on Raspberry Pi:</h2>
<p>Login back into the Raspberry Pi and run the sensor container in an interactive mode using the following command -</p>
<pre><code>sudo docker run --privileged -it -v /home/pi/settings:/usr/src/app/settings pradeesi/rapi_cl_hc_sensor
</code></pre>
<h2 id="7-configure-raspberry-pi-to-trigger-the-sensor-container-at-startup">7. Configure Raspberry Pi to Trigger the Sensor Container at Startup:</h2>
<p><strong>7.1</strong> open the 'rc.local' using the following command -</p>
<pre><code>sudo vi /etc/rc.local
</code></pre>
<p><strong>7.2</strong> Add following command at the top of this file (preferably in the first line) - </p>
<pre><code>sudo docker run --privileged -d -v /home/pi/settings:/usr/src/app/settings pradeesi/rapi_cl_hc_sensor
</code></pre>
<p><strong>7.3</strong> Save the file using '<strong>Esc + :wq</strong>' command on vi editor.</p>
<p><strong>7.4</strong> Change the execution bit using the following command -</p>
<pre><code>sudo chmod +x /etc/rc.local
</code></pre>
<p><strong>7.5</strong> Reboot the Raspberry Pi using '<strong>sudo reboot</strong>'. </p>
<p><strong>7.6</strong> After the reboot process gets completed, login back to the Raspberry Pi and check if the sensor container is running using the command '<strong>sudo docker ps</strong>'.</p>
<p><strong>Note:</strong> If the docker container is not getting triggered on system startup, add 5 second delay by adding '<strong>sleep 5</strong>' before the docker command added in the 'rc.local' file (in Step# 7.2).</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"search": 83, "next": 78, "help": 191, "previous": 80};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
